<!DOCTYPE html>
<html>
<head>
  <title>Admin Login</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h2>Admin Login</h2>

<div id="loginBox">
  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <p id="error" style="color:red"></p>
</div>

<div id="dashboard" style="display:none">
  <h2>Orders</h2>
  <ul id="orders"></ul>
</div>

<script>
let auth = {};

async function login() {
  const res = await fetch("/api/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      username: document.getElementById("username").value,
      password: document.getElementById("password").value
    })
  });

  if (!res.ok) {
    document.getElementById("error").innerText = "Invalid login";
    return;
  }

  auth = {
    username: document.getElementById("username").value,
    password: document.getElementById("password").value
  };

  document.getElementById("loginBox").style.display = "none";
  document.getElementById("dashboard").style.display = "block";
  loadOrders();
}

async function loadOrders() {
  const res = await fetch("/api/orders", {
    headers: auth
  });

  if (!res.ok) {
    alert("Unauthorized");
    return;
  }

  const data = await res.json();
  const ordersList = document.getElementById("orders");
  ordersList.innerHTML = "";

  data.forEach(o => {
    const li = document.createElement("li");
    li.innerHTML = `
      <input value="${o.name}" id="name-${o.id}">
      <input value="${o.product}" id="product-${o.id}">
      <button onclick="updateOrder(${o.id})">Update</button>
      <button onclick="deleteOrder(${o.id})">Delete</button>
    `;
    ordersList.appendChild(li);
  });
}

async function updateOrder(id) {
  await fetch("/api/order/" + id, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      ...auth
    },
    body: JSON.stringify({
      name: document.getElementById(`name-${id}`).value,
      product: document.getElementById(`product-${id}`).value
    })
  });

  alert("Order updated");
}

async function deleteOrder(id) {
  await fetch("/api/order/" + id, {
    method: "DELETE",
    headers: auth
  });

  loadOrders();
}
</script>

</body>
</html>
